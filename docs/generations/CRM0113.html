<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>CRM0113 Create Payment Orders | ERP.net Domain Model </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="CRM0113 Create Payment Orders | ERP.net Domain Model ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ErpNetDocs/model/blob/master/generations/CRM0113.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="crm0113-create-payment-orders">CRM0113 Create Payment Orders</h1>

<h2 id="basic-information">Basic Information</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Module</th>
<th>Crm.Sales</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Code</td>
<td>CRM0113</td>
</tr>
<tr>
<td style="text-align: left;">Parent Document</td>
<td>Sales Order</td>
</tr>
<tr>
<td style="text-align: left;">Sub-document</td>
<td>Payment Order</td>
</tr>
<tr>
<td style="text-align: left;">Full Name</td>
<td>Create Payment orders</td>
</tr>
<tr>
<td style="text-align: left;">Status</td>
<td><a class="xref" href="https://erpnetdocs.github.io/tech/advanced/document-flow/generation-procedures.html">NEW</a></td>
</tr>
<tr>
<td style="text-align: left;">Deterministic</td>
<td><a class="xref" href="https://erpnetdocs.github.io/tech/advanced/document-flow/deterministic-generations.html">YES</a></td>
</tr>
<tr>
<td style="text-align: left;">Supports Transitional Documents</td>
<td><a class="xref" href="https://erpnetdocs.github.io/tech/advanced/document-flow/transitional-documents.html">YES</a></td>
</tr>
<tr>
<td style="text-align: left;">Replaces</td>
<td>GeneratePaymentOrdersByPlanV2</td>
</tr>
<tr>
<td style="text-align: left;">Orphan Rows</td>
<td>Ignore</td>
</tr>
<tr>
<td style="text-align: left;">Split Function</td>
<td>SalesOrderPaymentPlan.InstallmentNumber</td>
</tr>
<tr>
<td style="text-align: left;">Introduced In Version</td>
<td></td>
</tr>
<tr>
<td style="text-align: left;">Date of Suspension</td>
<td>-</td>
</tr>
</tbody>
</table>
<h2 id="business-logic">Business Logic</h2>
<p>This Generation Procedure is used to create Payment Orders by the Sales Oder Payment Plan of the current Sales Order.
For each instalment of the payment plan could be created one or more Payment Orders (depending on whether the amount of the instalment is broken down by invoice or not).
Currently, for the Generation there are three available settings (set in &quot;SalesOrderPaymentOrdersTemplate&quot; of the line of the particular Route):</p>
<ul>
<li>&quot;Is Amount With VAT&quot; - this setting specifies whether or not the field &quot;IsAmountWithVAT&quot; in the created Payment Orders will be check-marked;</li>
<li>&quot;Create For Not Invoiced Amounts&quot; - this setting specifies whether Payment Orders for the payment plan Amounts that have not yet been invoiced will be created;</li>
<li>&quot;Create For Invoiced Amounts&quot; - this setting specifies whether Payment Orders for payment plan Amounts that have already been invoiced will be created.</li>
</ul>
<div class="NOTE">
<h5>Note</h5>
<p>The &quot;Update For Invoices&quot; setting is no longer in use.</p>
</div>
<h2 id="fulfillments">Fulfillments</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th><strong>AmountToPaymentOrder</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Parent Entity</td>
<td><strong>Amount</strong></td>
</tr>
<tr>
<td style="text-align: left;">Child Entity</td>
<td><strong>PaymentOrder</strong></td>
</tr>
<tr>
<td style="text-align: left;">Parent / Child Relationship</td>
<td><strong>PaymentOrder.ParentDocument = SalesOrder;</strong> <strong>PaymentOrder.RefDocument = Amount.RefDocument;</strong> <strong>PaymentOrder.RefInvoiceDocument = Amount.RefInvoiceDocument;</strong> <strong>PaymentOrder.InstallmentNumber = Amount.InstallmentNumber</strong></td>
</tr>
</tbody>
</table>
<h2 id="metrics"><a href="../reference/metrics.html">Metrics</a></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Fulfillment Name</th>
<th style="text-align: center;">Metric Name</th>
<th style="text-align: center;">Measurement Unit</th>
<th style="text-align: left;">Parent Value</th>
<th style="text-align: left;">Child Value</th>
<th style="text-align: left;">New Record</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">AmountToPaymentOrder</td>
<td style="text-align: center;">MTotalAmount</td>
<td style="text-align: center;">Amount.TotalAmountCurrency</td>
<td style="text-align: left;">Amount.TotalAmount (for every Amount)</td>
<td style="text-align: left;">PaymentOrder.TotalAmount</td>
<td style="text-align: left;">YES</td>
</tr>
<tr>
<td style="text-align: left;">AmountToPaymentOrder</td>
<td style="text-align: center;">MInvoiceAmount</td>
<td style="text-align: center;">Amount.TotalAmountCurrency</td>
<td style="text-align: left;">Amount.InvoiceAmount (for every Amount)</td>
<td style="text-align: left;">PaymentOrder.InvoiceAmount</td>
<td style="text-align: left;">YES</td>
</tr>
</tbody>
</table>
<p>The creation of the Payment Orders begins with the calculation of the Amounts of instalments of the current Sales Order.
These amounts are then being broken down by the Invoices that have been created for Sales Order.
Calculation of amounts depends on the &quot;Create For Not Invoiced Amounts&quot; and &quot;Create For Invoiced Amounts&quot; settings.
This is detailed in the topic <a href="xref:sales-order-payment-plan">Sales Order Payment Plan</a>.
Thus, for the current Sales Order is determined a list of Amounts.
Then for each Amount are calculated the amounts of the metrics that are not yet fulfilled by other Payment Orders that have already been created (for more information, see topic <a href="../reference/discrepancy-system.html">Discrepancy System</a> and <a href="../reference/metrics.html">Metrics</a>).
If for an Amount any of the Metrics with &quot;New Record = YES&quot; is different from 0, then for this Amount is created a new Payment Order.</p>
<p>The new Payment Order is created as follows (the determination of the Amount's attributes' values is described in the topic <a href="xref:sales-order-payment-plan">Sales Order Payment Plan</a>):</p>
<pre><code>PaymentOder.Notes = Amount.DocumentNotes
PaymentOder.Party = Amount.Party
PaymentOder.Direction = Income
PaymentOder.InstallmentNumber = Amount.InstallmentNumber
PaymentOder.DueDate = Amount.DueDate
PaymentOder.DueStartDate = Amount.DueStartDate
PaymentOder.TotalAmountCurrency = Amount.TotalAmountCurrency
PaymentOder.TotalAmount = Amount.REMAINING(MTotalAmount)
PaymentOder.PaymentAccount = Amount.PaymentAccount
PaymentOder.PaymentType = Amount.PaymentType
PaymentOder.RefDocument = Amount.RefDocument
PaymentOder.RefInvoiceDocument = Amount.RefInvoiceDocument
PaymentOder.InvoiceAmountCurrency = Amount.InvoiceAmountCurrency
PaymentOder.InvoiceAmount = Amount.REMAINING(MInvoiceAmount)
PaymentOder.LocationParty = Amount.LocationPartyPaymentOder.IsAmountWithVATPaymentOder.IsAmountWithVAT = if(Route.SalesOrderPaymentOrdersTemplate.IsAmountWithVAT == true, true, false)
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ErpNetDocs/model/blob/master/generations/CRM0113.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
