<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>CRM0706 Create Offers | ERP.net Domain Model </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="CRM0706 Create Offers | ERP.net Domain Model ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ErpNetDocs/model/blob/master/generations/CRM0706.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="crm0706-create-offers">CRM0706 Create Offers</h1>

<h2 id="basic-information">Basic Information</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Module</th>
<th>Applications.Service</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Code</td>
<td>CRM0706</td>
</tr>
<tr>
<td style="text-align: left;">Parent Document</td>
<td>Service Activity</td>
</tr>
<tr>
<td style="text-align: left;">Sub-document</td>
<td>Offer</td>
</tr>
<tr>
<td style="text-align: left;">Full Name</td>
<td>Create Offers</td>
</tr>
<tr>
<td style="text-align: left;">Status</td>
<td><a class="xref" href="https://erpnetdocs.github.io/tech/advanced/document-flow/generation-procedures.html">NEW</a></td>
</tr>
<tr>
<td style="text-align: left;">Deterministic/Non-deterministic</td>
<td><a href="xref:deterministic-generations">YES</a></td>
</tr>
<tr>
<td style="text-align: left;">Transitional Documents</td>
<td><a href="xref:transitional-documents">NO</a></td>
</tr>
<tr>
<td style="text-align: left;">Replace Generation Procedures</td>
<td>GenerateOffer</td>
</tr>
<tr>
<td style="text-align: left;">Processing Orphan Rows</td>
<td>None</td>
</tr>
<tr>
<td style="text-align: left;">Introduced In Version</td>
<td></td>
</tr>
<tr>
<td style="text-align: left;">Date of Suspension</td>
<td>-</td>
</tr>
</tbody>
</table>
<h2 id="business-logic">Business Logic</h2>
<p>The generation procedure creates Offer which purpose is to offer to the customer the used materials and the completed services listed in the service activity.
The generation includes only materials and services which are not covered by the guarantee determined by the Service Agreements.</p>
<p><strong>The offer header is based on the service activity header as follows:</strong></p>
<pre><code>Offer.Customer = ServiceActivity.Customer
Offer.ShipToCustomer = ServiceActivity.ShipToCustomer
Offer.Store = ServiceActivity.Store
Offer.DocumentCurrency = ServiceActivity.EnterpriseCompany.BaseCurrency
</code></pre>
<p>When the customer is filled in the offer a validation is performed which secures that the customer has up to date conditions in its definition (or that the Offer date is included in the period of those conditions) and the customer has no up to date condition - the generation procedure stops and throws an error.
Up to date customer conditions are conditions where:</p>
<pre><code>- (Offer.DocumentDate &gt;= Customer.FromDate || Customer.FromDate == null ) &amp;&amp; (Offer.DocumentDate &lt;= Customer.thruDate || Customer.ThruDate == null)
</code></pre>
<p>The Offer Lines are created according to the calculations of the non agreed materials and services (as described in <a href="xref:non-agreed-services-and-materials">Non Agreed Services And Materials</a>).
So for each material of the current Service Activity the non agreed quantity of the material is calculated and the calculation for the services is a bit more complicated - for each service and for each product which invoice the service (these products are listed in the service definition), the non agreed quantity of the product is calculated.</p>
<p>Thus for each material ServiceActivityMaterial which has CoveredByGuarantee = false, the non agreed quantity is defined - <strong>NonagreedQuantity</strong> - and if it is not <strong>0</strong>, a new OfferLine is created in the new Offer as follows:</p>
<pre><code>OfferLine.LineNo = new line number
OfferLine.Product = ServiceActivityMaterial.Product
OfferLine.Quantity = ServiceActivityMaterial.NonagreedQuantity
OfferLine.QuantityUnit = ServiceActivityMaterial.QuantityUnit
OfferLine.LineStore = ServiceActivityMaterial.LineStore
OfferLine.ParentLineNo = ServiceActivityMaterial.LineNo
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>The attributes which are not specified here are filled in as described in <a href="../reference/standard-document-attributes.html">Standard Document Attributes</a></p>
</div>
<p>The new store order is saved then and only when there is at least one line in it.</p>
<p>Then for each service ServiceActivityService which has CoveredByGuarantee = false, and for each product <strong>InvoicingProduct</strong> - which invoice the current service (the products are listed as ServiceInvoicing where Service = current service), the non agreed quantity is defined - <strong>NonagreedQuantity</strong> - and if it is not <strong>0</strong>, a new OfferLine in the new Offer is added as follows:</p>
<pre><code>OfferLine.LineNo = new line number
OfferLine.Product = InvoicingProduct
OfferLine.Quantity = NonagreedQuantity
OfferLine.QuantityUnit = InvoicingProduct.BaseMeasurementUnit
OfferLine.ParentLineNo = ServiceActivityService.LineNo
</code></pre>
<h2 id="fulfillments">Fulfillments</h2>
<p>No fulfilments and metrics are used for the current generation procedure.
Each time the procedure is started, it creates new sub-document no matter if there are documents already created from previous procedure executions.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ErpNetDocs/model/blob/master/generations/CRM0706.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
